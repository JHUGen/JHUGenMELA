import Mela as me
import ROOT
import numpy as np

event1 = """
<event>
12	50	 1.0000000E+00	 1.2500000E+02	 7.8125000E-03	 1.2380607E-01
            2	 -1		0		0	503		0	0.00000000000E+00	0.00000000000E+00	1.65430825479E+03	1.65430825479E+03	0.00000000000E+00 0.00000000000E+00	1.
            -1	 -1		0		0		0	503	0.00000000000E+00	0.00000000000E+00 -1.42857195999E+01	1.42857195999E+01	0.00000000000E+00 0.00000000000E+00	1.
            24		2		1		2		0		0 -2.29473352103E+00 -1.04804828491E+02	4.95291431378E+02	5.12296652853E+02	7.83896718395E+01 0.00000000000E+00	1.
            25		2		1		2		0		0	2.29473352103E+00	1.04804828491E+02	1.14473110382E+03	1.15629732154E+03	1.24999511524E+02 0.00000000000E+00	1.
            14		1		3		3		0		0	4.42035961901E+00 -5.60456350211E+01	4.09886160671E+02	4.13723721213E+02	8.42936970218E-06 0.00000000000E+00	1.
        -13		1		3		3		0		0 -6.71509314004E+00 -4.87591934698E+01	8.54052707068E+01	9.85729316407E+01	1.05660000144E-01 0.00000000000E+00	1.
            23		2		4		4		0		0 -2.00748771644E+01	3.21702667586E+01	3.27018956548E+02	3.30034988785E+02	2.33188576920E+01 0.00000000000E+00	1.
            23		2		4		4		0		0	2.23696106855E+01	7.26345617324E+01	8.17712147272E+02	8.26262332755E+02	9.09950970840E+01 0.00000000000E+00	1.
        -11		1		7		7		0		0 -1.74223737299E+01	9.11950220870E+00	1.06644211152E+02	1.08442114510E+02	5.11001208360E-04 0.00000000000E+00	1.
            11		1		7		7		0		0 -2.65250343458E+00	2.30507645499E+01	2.20374745396E+02	2.21592874275E+02	5.10994690391E-04 0.00000000000E+00	1.
        -13		1		8		8		0		0	8.81223774828E+00	8.87930337607E+01	5.03683096793E+02	5.11525690007E+02	1.05660000328E-01 0.00000000000E+00	1.
            13		1		8		8		0		0	1.35573729372E+01 -1.61584720283E+01	3.14029050479E+02	3.14736642748E+02	1.05659999907E-01 0.00000000000E+00	1.
</event>
"""
event2 = """
<event>
12	50	 1.0000000E+00	 1.2500000E+02	 7.8125000E-03	 1.2380607E-01
            1	 -1		0		0	503		0	0.00000000000E+00	0.00000000000E+00	1.58591490197E+03	1.58591490197E+03	0.00000000000E+00 0.00000000000E+00	1.
            -1	 -1		0		0		0	503	0.00000000000E+00	0.00000000000E+00 -8.99084923758E+00	8.99084923758E+00	0.00000000000E+00 0.00000000000E+00	1.
            23		2		1		2		0		0	4.31808951699E+01	1.18843550193E+01	8.22005355890E+02	8.28398612649E+02	9.24425698805E+01 0.00000000000E+00	1.
            25		2		1		2		0		0 -4.31808951699E+01 -1.18843550193E+01	7.54918696840E+02	7.66507138556E+02	1.25000508063E+02 0.00000000000E+00	1.
            11		1		3		3		0		0 -1.35803884002E+01 -5.28931958672E+00	5.41360784563E+02	5.41556924907E+02	5.11072900539E-04 0.00000000000E+00	1.
        -11		1		3		3		0		0	5.67612835701E+01	1.71736746060E+01	2.80644571326E+02	2.86841687743E+02	5.11012071458E-04 0.00000000000E+00	1.
            23		2		4		4		0		0 -2.43038338852E+01	5.06442605250E+00	2.48359236741E+02	2.53284239962E+02	4.30612469142E+01 0.00000000000E+00	1.
            23		2		4		4		0		0 -1.88770612847E+01 -1.69487810718E+01	5.06559460099E+02	5.13222898594E+02	7.84324703350E+01 0.00000000000E+00	1.
        -13		1		7		7		0		0 -3.25370809281E+01 -6.79837669312E+00	2.02354268485E+02	2.05066186143E+02	1.05659999991E-01 0.00000000000E+00	1.
            13		1		7		7		0		0	8.23324704291E+00	1.18628027456E+01	4.60049682560E+01	4.82180538193E+01	1.05659999989E-01 0.00000000000E+00	1.
        -13		1		8		8		0		0	4.59433181687E+00 -3.18015647781E+01	4.39027117172E+02	4.40201395027E+02	1.05659999655E-01 0.00000000000E+00	1.
            13		1		8		8		0		0 -2.34713931016E+01	1.48527837063E+01	6.75323429266E+01	7.30215035668E+01	1.05660000010E-01 0.00000000000E+00	1.
</event>
"""
event3 = """
<event>
11	60	 1.0000000E+00	 1.2500000E+02	 7.8125000E-03	 1.2380607E-01
            1	 -1		0		0	501		0	0.00000000000E+00	0.00000000000E+00	8.38349783822E+01	8.38349783822E+01	0.00000000000E+00 0.00000000000E+00	1.
            2	 -1		0		0	502		0	0.00000000000E+00	0.00000000000E+00 -8.69647303563E+02	8.69647303563E+02	0.00000000000E+00 0.00000000000E+00	1.
            4		1		1		2	501		0	4.93534233194E+01 -7.45486758049E+00	2.54822242213E+01	5.60417629563E+01	0.00000000000E+00 0.00000000000E+00	1.
            1		1		1		2	502		0 -4.29482465415E+01	4.39907893858E+01 -7.51475061906E+02	7.53985749267E+02	0.00000000000E+00 0.00000000000E+00	1.
            25		2		1		2		0		0 -6.40517677787E+00 -3.65359218053E+01 -5.98194874970E+01	1.43454769722E+02	1.25000000000E+02 0.00000000000E+00	1.
            23		2		5		5		0		0 -1.61638014503E+01 -3.55963825472E+01 -2.51394501445E+01	1.03431837860E+02	9.24001201399E+01 0.00000000000E+00	1.
            23		2		5		5		0		0	9.75862467247E+00 -9.39539258134E-01 -3.46800373525E+01	4.00229318615E+01	1.74073718437E+01 0.00000000000E+00	1.
        -11		1		6		6		0		0	3.37109433312E+01 -2.97615359833E+01	4.38251799494E+00	4.51816687231E+01	5.11000134768E-04 0.00000000000E+00	1.
            11		1		6		6		0		0 -4.98747447816E+01 -5.83484656388E+00 -2.95219681394E+01	5.82501691374E+01	5.11001208360E-04 0.00000000000E+00	1.
        -13		1		7		7		0		0	1.46596263059E+01	5.33582780943E-01 -2.31337995488E+01	2.73929406894E+01	1.05660000000E-01 0.00000000000E+00	1.
            13		1		7		7		0		0 -4.90100163341E+00 -1.47312203908E+00 -1.15462378037E+01	1.26299911721E+01	1.05660000000E-01 0.00000000000E+00	1.
</event>
"""

daughters = """
11 -71.89077865749999319 30.50307494750000004 -47.20025487019999844 91.25012710839999386
-11 -25.13451734110000046 -18.85931656560000036 -81.42283896300000379 87.27597887359999618
11 -51.80274100940000181 1.64269040236999997 -41.79162596869999646 66.57899375339999892
-11 -93.72924763700000028 39.45060783929999815 -92.98363978320000456 137.79506373300000632
"""
associated = """
-1 211.33318543799998679 -14.90577872979999974 3.74371777679000006 211.89127619999999297
2 31.22409920730000010 -37.83127789369999761 1.23465418111000003 49.06805813689999951
"""
mothers = """
-1 0.00000000000000000 0.00000000000000000 192.71975508899998886 192.71975508899998886
2 0.00000000000000000 0.00000000000000000 -451.13974271600000066 451.13974271600000066
"""

def tlv(id_, x,y,z,e):
    id_ = int(id_)
    x,y,z,e = float(x), float(y), float(z), float(e)
    return me.SimpleParticle_t(id_, x,y,z,e)


m = me.Mela(13, 125, me.VerbosityLevel.SILENT)

daughters =  [tlv(*list(map(float, line.split()))) for line in daughters.split("\n") if line.split()]
associated = [tlv(*list(map(float, line.split()))) for line in associated.split("\n") if line.split()]
mothers =    [tlv(*list(map(float, line.split()))) for line in mothers.split("\n") if line.split()]

m.setInputEvent(
    me.SimpleParticleCollection_t(daughters),
    me.SimpleParticleCollection_t(),
    me.SimpleParticleCollection_t(),
    True
)

m.setProcess(me.Process.SelfDefine_spin0, me.MatrixElement.JHUGen, me.Production.ZZINDEPENDENT)

# m.selfDHggcoupl()[0, me.HGG_indices.gHIGGS_GG_2] = [1,0]
# m.selfDHzzcoupl()[0, me.HVV_indices.gHIGGS_VV_1] = [1,0]

m.ghz1 = [1,0]
m.ghg2 = [1,0]
x = m.computeP(False)
print("RESULT:", x)

print("MELAIO")
arr = m.getWeightedMEArray()
print(arr)
arr = m.getUnweightedMEArray()
print(arr)

arr_weights = m.getPartonWeights()
print(arr_weights)